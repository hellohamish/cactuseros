(function(a){a.fn.epicZoom=function(b){var e=a("body");var d={isInBounds:function(g,f,i,h){if(g.pageX<(f.left+h.left)||g.pageX>(f.left+i.width+h.left)||g.pageY<(f.top+h.top)||g.pageY>(f.top+i.height+h.top)){return false}else{return true}},isDebug:function(){if(b.debug&&typeof console!=="undefined"){return true}else{return false}}};var c={size:300,border:"1px solid white",largeImage:"",magnification:1,hideCursor:true,blankCursor:"./js/blank.png",debug:false};b=a.extend(c,b);b.debug=Boolean(b.debug);if(d.isDebug()){console.warn("Epic Image Zoom debugging is enabled.")}b.size=parseInt(b.size,10);b.magnification=parseFloat(b.magnification);b.hideCursor=Boolean(b.hideCursor);b.largeImage=a.trim(b.largeImage);b.blankCursor=a.trim(b.blankCursor);if(d.isDebug()){console.log("EIZ; options: ",b)}return this.each(function(){var g=a(this);if(!g.is("img")){if(d.isDebug()){console.error("EIZ works only on img elements.")}return this}var f=a("<img />");if(b.largeImage){f.attr("src",b.largeImage)}else{f.attr("src",g.attr("src"))}f.load(function(){if(f.hasInit){return false}f.hasInit=true;if(typeof e.data("epicZoom-nb")==="undefined"){e.data("epicZoom-nb",0)}e.data("epicZoom-nb",e.data("epicZoom-nb")+1);var s=e.data("epicZoom-nb");if(d.isDebug()){console.log("EIZ; #",s)}g.wrap('<span id="eiz-'+s+'" class="eiz-container"></span>');var r=a("#eiz-"+s).css("margin",0).css("padding",0).css("border",0);r.append('<span class="eiz-magnifier"></span>');var q=a(".eiz-magnifier",r).css("position","absolute").css("margin",0).css("padding",0).css("border",b.border).css("-moz-box-shadow","0 0 5px #777, 0 0 10px #aaa inset").css("-webkit-box-shadow","0 0 5px #777").css("box-shadow","0 0 5px #777, 0 0 10px #aaa inset").css("overflow","hidden").css("z-index",999999).css("width",b.size+"px").css("height",b.size+"px");q.append('<div><img alt="" title="" /></div>');var p=a("img",q).css("margin",0).css("padding",0).css("border",0);if(b.largeImage){p.attr("src",b.largeImage)}else{p.attr("src",g.attr("src"))}if(b.hideCursor){p.css("cursor","none").css("cursor","url("+b.blankCursor+"),none !important;")}var o=a("div",q).css("position","absolute").css("margin",0).css("padding",0).css("border",0).css("z-index",1).css("overflow","hidden");p.width(p.width()*b.magnification);var n=p.width()/g.width();var m={left:g.offset().left,top:g.offset().top};var l={width:g.width(),height:g.height()};var k={top:parseInt(g.css("padding-top"),10),right:parseInt(g.css("padding-right"),10),bottom:parseInt(g.css("padding-bottom"),10),left:parseInt(g.css("padding-left"),10)};q.hide();a(window).resize(function(){m={left:g.offset().left,top:g.offset().top};l={width:g.width(),height:g.height()};if(d.isDebug()){console.log("EIZ #"+s+": window resized, vars recalculated")}});r.mousemove(function(h){if(!d.isInBounds(h,m,l,k)){if(!q.is(":animated")){if(d.isDebug()){console.log("EIZ #"+s+": out of bounds")}r.trigger("mouseleave")}return false}if(q.is(":not(:animated):hidden")){r.trigger("mouseenter")}q.css("left",h.pageX-b.size/2);q.css("top",h.pageY-b.size/2);o.css("left",-1*(h.pageX-m.left-k.left)*n+b.size/2);o.css("top",-1*(h.pageY-m.top-k.top)*n+b.size/2)}).mouseleave(function(){q.stop(true,true).hide()}).mouseenter(function(h){if(d.isDebug()){console.log("EIZ #"+s+": mouse enter container")}if(!d.isInBounds(h,m,l,k)){return false}q.stop(true,true).show()})});if(f.complete||f.naturalWidth>0){f.trigger("load")}})}}(jQuery));